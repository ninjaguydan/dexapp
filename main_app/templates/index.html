{% extends 'base.html' %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'index.css' %}">
{% endblock %}

{% block js %}
    <script src="{% static 'pkmn.js' %}" defer></script>
{% endblock %}

{% block title %}| Home{% endblock %}


<!------------------------ Body ------------------------>
{% block content %}

<!-- Left column content -->
<div class="column">
    {% if "userid" not in request.session %}
    <!-- If no one is logged in, don't display post form -->
    {% else %}
    <!-- Post Form -->
    <div class="card">
        <img src="{% static '' %}img/default-profiles/{{user.default_img}}.png" alt="profile pic" class="card-item user-img {{user.bg_color}}">
        <form action="/profile/{{user.id}}/create_post" method="POST">
            {% csrf_token %}
            <textarea class="form-control form-control-custom" name="post" rows="1" placeholder="What's on your mind?"></textarea>
            <div class="btn-container">
                <button class="btn btn-primary btn-post">Post</button>
            </div>
        </form>
    </div>
    {% endif %}
    <!-- Timeline Feed -->
    {% for post in posts reversed %}
    <div class="card">
        <img src="{% static '' %}img/default-profiles/{{post.added_by.default_img}}.png" alt="profile pic" class="card-item user-img {{post.added_by.bg_color}}">
        <div class="card-item card-item-content">
            <a href="/profile/{{post.added_by.id}}"><p class="bold">{{post.added_by.first_name}} {{post.added_by.last_name}} </a><span>{{post.added_by.username}}</span></p>
            <p>{{post.content}}</p>
            <p class="time">{{post.created_at|timesince}} ago {% if request.session.userid == post.added_by.id %}| <a href="/profile/{{post.id}}/delete_post"><i class="material-icons">delete</i></a>{% endif %}</p>
        </div>
        <div class="card-item-icons">
            {% if "userid" not in request.session %}
            <!-- If no one is logged in, non-clickable heart is displayed -->
            <i class="material-icons">favorite_border</i>
            {% elif user not in post.likes.all %}
            <!-- "Like Post" form -->
            <form action="/profile/like_post" method="POST">
                {% csrf_token %}
                <input type="hidden" name="like" value="{{post.id}}">
                <button><i class="material-icons">favorite_border</i></button>
            </form>
            {% else %}
            <!-- "Unlike Post" form -->
            <form action="/profile/like_post" method="POST">
                {% csrf_token %}
                <input type="hidden" name="like" value="{{post.id}}">
                <button><i class="material-icons active">favorite</i></button>
            </form>
            {% endif %}
            <p>{{post.likes.all|length}}</p>
            <i class="material-icons reply">chat_bubble_outline</i>
            <p>{{post.comments.all|length}}</p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Right column content -->
<div class="column rank">
    <!-- Search bar -->
    <form action="" method="" role="search" class="search-form">
        {% csrf_token %}
        <input type="search" name="search" class="form-control" placeholder="Search DexApp">
        <button id="search"><i class="material-icons">search</i></button>
    </form>
    <!-- Top 10 Pokemon ordered by "Likes" -->
    <ol class="list-group">
        <li class="list-group-item">
            <h5 class="bold">Top Pokemon</h5>
        </li>
        {% for pokemon in all_pokemon %}
        <li class="list-group-item">
            <!-- Rank number here from CSS -->
            <a href="/{{pokemon.id}}"><img src="{{pokemon.art_url}}" alt="{{pokemon.name}}'s official art"></a>
            <div class="info">
                <a href="/{{pokemon.id}}"><h6 class="bold">{{pokemon.name|title}}</h6></a>
                <div class="icons">
                    <h6><i class="material-icons">favorite</i> 66</h6>
                    <h6><i class="material-icons">star</i> 66</h6>
                </div>
            </div>
        </li>
        {% endfor %}
    </ol>

</div>


{% endblock %}