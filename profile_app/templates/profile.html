{% extends 'base.html' %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'profile.css' %}">
{% endblock %}

{% block title %}| {{user.username}}{% endblock %}

<!------------------------ Body ------------------------>
{% block content %}

<!-- Left column content -->
<div class="column profile">
    <ul class="list-group">
        <li class="list-group-item">
            <h4>{{profile.first_name}} {{profile.last_name}}</h4>
            <h6>{{profile.username}}</h6>
            <img src="{% static '' %}img/default-profiles/{{profile.default_img}}.png" class="{{profile.bg_color}}">
            <!-- Display bio if one exists -->
            {% if profile.profile.bio %}
            <p>{{profile.profile.bio}}</p>
            {% endif %}
            <div class="follow-cnt">
                <p><span class="bold">{{profile.profile.following.all|length}}</span> Following</p>
                <p><span class="bold">{{profile.following.all|length}}</span> Follower{{profile.following.all|length|pluralize}}</p>
            </div>
        </li>
        {% if request.session.userid == profile.id %}
        <!-- Display "Edit profile" button if Profile belongs to user -->
        <li class="list-group-item interact">
            <button class="btn btn-secondary btn-profile" id="edit-profile">Edit Profile</button>
        </li>
        {% elif "userid" not in request.session %}
        <!-- Display nothing if no one is logged in -->
        {% else %}
        <!-- Display "follow" and "message" buttons -->
        <li class="list-group-item interact">
            {% if profile not in user.profile.following.all %}
                <!-- Follow profile if not already -->
                <form action="/profile/follow" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="follow" value="{{profile.id}}">
                    <button class="bold"><i class="material-icons">group_add</i> Follow</button>
                </form>
            {% else %}
                <!-- Unfollow profile -->
                <form action="/profile/follow" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="follow" value="{{profile.id}}">
                    <button class="active bold"><i class="material-icons">group_add</i> Following</button>
                </form>
            {% endif %}
                <p class="bold"><i class="material-icons">mail_outline</i> Message</p>
        </li>
        {% endif %}
        {% if profile.profile.location != "None" %}
        <!-- Display Location if one was given -->
        <li class="list-group-item striped">
            <p class="bold">Location</p>
            <span>{{profile.profile.location}}</span>
        </li>
        {% endif %}
        <li class="list-group-item striped">
            <p class="bold">Joined</p>
            <span>{{profile.created_at|date:"F Y"}}</span>
        </li>
        {% if profile.profile.pronouns != "None" %}
        <!-- Display pronouns if they were given -->
        <li class="list-group-item striped">
            <p class="bold">Pronouns</p>
            <span>{{profile.profile.pronouns}}</span>
        </li>
        {% endif %}
        <li class="list-group-item striped">
            <p class="bold">Posts</p>
            <span>{{profile.posts.all|length}}</span>
        </li>
        <li class="list-group-item striped">
            <p class="bold">Reviews</p>
            <span>{{profile.reviews_added.all|length}}</span>
        </li>
        <li class="list-group-item striped">
            <p class="bold">Favorites</p>
            <span>{{profile.favorites.all|length}}</span>
        </li>
        <li class="list-group-item striped">
            <p class="bold">Teams</p>
            <span>{{profile.teams.all|length}}</span>
        </li>
    </ul>
</div><br><br><br>



<!---------- Right Column content ---------->
<div class="column posts" id="tabs">
    <ul class="tab-nav">
        <li class="bold"><a href="#tabs-1" class="active">Posts</a></li>
        <li class="bold"><a href="#tabs-2">Reviews</a></li>
        <li class="bold"><a href="#tabs-3">Favorites</a></li>
        <li class="bold"><a href="#tabs-4">Teams</a></li>
    </ul>

    <!-- 'Posts' Tab -->
    <div id="tabs-1">
        {% if request.session.userid != profile.id  %}
            <!-- If profile doesn't belong to user, don't display post form -->
            {% else %}
            <!-- Post Form -->
            <div class="card">
                <img src="{% static '' %}img/default-profiles/{{user.default_img}}.png" alt="profile pic" class="card-item user-img {{user.bg_color}}">
                <form action="/profile/{{user.id}}/create_post" method="POST">
                    {% csrf_token %}
                    <textarea class="form-control form-control-custom" name="post" rows="1" placeholder="What's on your mind?"></textarea>
                    <div class="btn-container">
                        <button class="btn btn-primary btn-post">Post</button>
                    </div>
                </form>
            </div>
        {% endif %}

        <!-- Profile's Feed -->
        {% for post in profile.posts.all reversed %}
        <div class="card">
            <img src="{% static '' %}img/default-profiles/{{post.added_by.default_img}}.png" alt="profile pic" class="card-item user-img {{post.added_by.bg_color}}">
            <div class="card-item card-item-content">
                <a href="/profile/{{post.added_by.id}}"><p class="bold">{{post.added_by.first_name}} {{post.added_by.last_name}} </a><span>{{post.added_by.username}}</span></p>
                <p>{{post.content}}</p>
                <p class="time">{{post.created_at}} {% if request.session.userid == post.added_by.id %}| <a href="/profile/{{post.id}}/delete_post"><i class="material-icons">delete</i></a>{% endif %}</p>
            </div>
            <!-- Side icons -->
            <div class="card-item-icons">
                {% if "userid" not in request.session %}
                <!-- If no one is logged in, non-clickable heart is displayed -->
                <i class="material-icons">favorite_border</i>
                {% elif user not in post.likes.all %}
                <!-- "Like Post" form -->
                <form action="/profile/like_post" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="like" value="{{post.id}}">
                    <button><i class="material-icons">favorite_border</i></button>
                </form>
                {% else %}
                <!-- "Unlike Post" form -->
                <form action="/profile/like_post" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="like" value="{{post.id}}">
                    <button><i class="material-icons active">favorite</i></button>
                </form>
                {% endif %}
                <p>{{post.likes.all|length}}</p>
                <i class="material-icons reply" post_id="{{post.id}}">chat_bubble_outline</i>
                <p>{{post.comments.all|length}}</p>
            </div>
            <!-- Display following Div when chat bubble is clicked -->
            <div class="comment comment_{{post.id}}">
                {% if request.session.userid %}
                <!-- Display Reply Form if a user is logged in -->
                <form action="/profile/{{post.id}}/comment_post" method="POST" class="comment_form">
                    {% csrf_token %}
                    <textarea name="comment" class="form-control form-control-custom" rows="1" placeholder="Leave a reply..."></textarea>
                    <div class="btn-container">
                        <button class="btn btn-primary btn-post">Reply</button>
                    </div>
                </form>
                {% else %}
                <!-- don't display the form if no one is logged in -->
                {% endif %}
                <!-- All reply comments -->
                {% if post.comments.all %}
                <!-- If any comments exist, dispaly them -->
                {% for comment in post.comments.all %}
                <div class="card card-reply">
                    <img src="{% static '' %}img/default-profiles/{{comment.added_by.default_img}}.png" alt="profile pic" class="card-item user-img {{comment.added_by.bg_color}}">
                    <div class="card-item card-item-content">
                        <a href="/profile/{{comment.added_by.id}}"><p class="bold">{{comment.added_by.first_name}} {{comment.added_by.last_name}} </a><span>{{comment.added_by.username}}</span></p>
                        <p>{{comment.content}}</p>
                        <p class="time">{{comment.created_at}} {% if request.session.userid == comment.added_by.id %}| <a href="/profile/{{comment.id}}/delete_post_comment"><i class="material-icons">delete</i></a>{% endif %}</p>
                    </div>
                    <!-- Side icons -->
                    <div class="card-item-icons">
                        {% if "userid" not in request.session %}
                        <!-- If no one is logged in, non-clickable heart is displayed -->
                        <i class="material-icons">favorite_border</i>
                        {% elif user not in comment.likes.all %}
                        <!-- "Like Comment" form -->
                        <form action="/profile/like_post_comment" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="like" value="{{comment.id}}">
                            <button><i class="material-icons">favorite_border</i></button>
                        </form>
                        {% else %}
                        <!-- "Unlike Comment" form -->
                        <form action="/profile/like_post_comment" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="like" value="{{comment.id}}">
                            <button><i class="material-icons active">favorite</i></button>
                        </form>
                        {% endif %}
                        <p>{{comment.likes.all|length}}</p>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 'Reviews' tab -->
    <div id="tabs-2"></div>
    
    <!-- 'Favorites' tab -->
    <div id="tabs-3"></div>
    
    <!-- 'Teams' tab -->
    <div id="tabs-4"></div>
    
</div>

<!---------------- "Edit Profile" popup modal ---------------->
<div class="modal-bg">
    <div class="edit-profile-modal">
        <div class="modal-head">
            <h4>Edit Profile</h4>
            <p id="close">&#10005;</p>
        </div>
        <hr>
        <form action="/profile/{{user.id}}/update" method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label>First Name</label>
                <input type="text" name="fname" value="{{user.first_name}}" class="form-control">
            </div>
            <div class="form-group">
                <label>Last Name</label>
                <input type="text" name="lname" value="{{user.last_name}}" class="form-control">
            </div>
            <div class="form-group">
                <label>Bio</label>
                <textarea name="bio" rows="4" class="form-control">{{user.profile.bio}}</textarea>
            </div>
            <div class="form-group">
                <label>Location</label>
                <input type="text" name="location" value="{{user.profile.location}}" class="form-control">
            </div>
            <div class="form-group">
                <label>Pronouns</label>
                <input type="text" name="pronouns" value="{{user.profile.pronouns}}" class="form-control">
            </div>
            <hr>
            <h6>Choose profile photo</h6>
            <div class="img-container">
                <img src="{% static 'img/default-profiles/1m.png' %}" id="1m">
                <img src="{% static 'img/default-profiles/2m.png' %}" id="2m">
                <img src="{% static 'img/default-profiles/3m.png' %}" id="3m">
                <img src="{% static 'img/default-profiles/1f.png' %}" id="1f">
                <img src="{% static 'img/default-profiles/2f.png' %}" id="2f">
                <img src="{% static 'img/default-profiles/3f.png' %}" id="3f">
                <input type="hidden" name="img" id="img" value="{{user.default_img}}">
            </div>
            <hr>
            <h6>Choose background color</h6>
            <div class="img-container colors">
                <span style="background-color: #272727;" color="gray"></span>
                <span style="background-color: #F20C32;" color="red"></span>
                <span style="background-color: #009DF1;" color="blue"></span>
                <span style="background-color: #198754;" color="green"></span>
                <span style="background-color: #ffc107;" color="yellow"></span>
                <span style="background-color: #6610f2;" color="purple"></span>
                <input type="hidden" name="color" id="color" value="{{user.bg_color}}">
            </div>
            <hr>
            <br>
            <button class="btn btn-primary">Update</button>
        </form>
    </div>
</div>
{% endblock %}