{% extends 'base.html' %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'messages.css' %}">
{% endblock %}

{% block js %}
    <script src="{% static 'messages.js' %}" defer></script>
{% endblock %}

{% block title %}| Messages{% endblock %}


<!------------------------ Body ------------------------>
{% block content %}
<!-- column of all threads -->
<div class="column message-list">
    {% for thread in threads %}
    {% if thread.messages.all|length != 0 %}
    <div class="card" thread_id="{{thread.id}}">
        {% for u in thread.users.all %}
        {% if u != user %}
        <a href="/profile/{{u.id}}" class="card-item"><img src="{{u.user_img.url}}" alt="profile pic" class="user-img {{u.bg_color}}"></a>
        <div class="card-item card-item-content">
            <div>
                <p class="bold">{{u.first_name}} {{u.last_name}} <span>{{u.username}}</span></p>
        {% endif %}
        {% endfor %}
                <small class="time">{{thread.updated_at|date:"SHORT_DATE_FORMAT"}}</small>
            </div>
            {% for message in thread.messages.all %}
            {% if forloop.last %}
            <p>{{message.content|truncatechars:99}}</p>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    {% empty %}
    <div class="card">
        <h5>No Messages yet!</h5>
    </div>
    {% endfor %}
</div>

<!-- Column of all messages in selected thread -->
<div class="column messages">
    <!-- <div class="ms-header">
        <i class="material-icons back">arrow_back</i>
        {% for u in display_thread.users.all %}
        {% if u != user %}
        <a href=""><img src="{{u.user_img.url}}" alt="profile pic" class="user-img {{u.bg_color}}"></a>
        <p class="bold">{{u.first_name}} {{u.last_name}}</p>
        {% endif %}
        {% endfor %}
    </div>
    <div class="msg-container" id="style-3">
        {% for message in display_thread.messages.all %}
            {% if message.sender == user %}
            <div class="sent-container">
                <p class="sent">{{message.content}}</p>
                <small class="time">{{message.created_at|date:"n/j/y, g:i a"}}</small>
            </div>
            {% else %}
            <div class="recieved-container">
                <p class="recieved">{{message.content}}</p>
                <small class="time">{{message.created_at|date:"n/j/y, g:i a"}}</small>
            </div>
            {% endif %}
        {% endfor %}
    </div>
    <form action="/profile/{{profile.id}}/send_message" class="card" method="POST">
        {% csrf_token %}
        <textarea name="message" rows="1" class="form-control form-control-custom"></textarea>
        <button><i class="material-icons">send</i></button>
    </form> -->
</div>



{% endblock %}